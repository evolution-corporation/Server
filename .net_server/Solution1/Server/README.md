# dotnet-6-crud-api

.NET 6.0 - CRUD API Example

Documentation at https://jasonwatmore.com/post/2022/03/15/net-6-crud-api-example-and-tutorial

## Роли пользователей

- NO_REGISTRATION - Информации об пользователе нет в системе
- USER - стандартный набор возможностей
- ADMIN - максимальный набор возможностей

## API методы

- Обработка информация об пользователях
    - /users
    - /authentication
    - /nickName
    - /user.image
    - /subscribe
    - /nickname
    - /user.image

- Обработка информации об медитациях
    - /meditation
    - /meditation.audio
    - /dmd

- Обработка платежей
    - /payment

### Уникальные типы данных

#### Перечисления

##### UserCategory(string)

- "NULL"
- "BLOGGER"
- "COMMUNITY"
- "ORGANIZATION"
- "EDITOR"
- "WRITER"
- "GARDENER"
- "FLOWER_MAN"
- "PHOTOGRAPHER"

##### UserGender(string)

- "MALE"
- "FEMALE"
- "OTHER"

##### UserRole(string)

- "USER"
- "ADMIN"

##### TypeMeditation(String):

- "relaxation"
- "breathingPractices"
- "directionalVisualizations"
- "dancePsychotechnics"
- "DMD"

##### CountDayMeditation(string):

- "2-3days"
- "4-5days"
- "6-7days"

##### TimeMeditation(string):

- "lessThan15minutes"
- "moreThan15AndLessThan60Minutes"
- "moreThan60Minutes"

#### Интерфейсы

##### MeditationPreferences

| Название       | Обязательный | Тип                |
|----------------|--------------|--------------------|
| typeMeditation | да           | TypeMeditation[]   |
| countDay       | да           | CountDayMeditation |
| time           | да           | TimeMeditation     |

### Параметры методов:

#### /users

- **GET**. Не требует авторизации. Не требует права администратора.
  > Возвращает информацию обо всех пользователях или конкретном

| Параметр                 | Обязательно | Описание                                                                                          |
|--------------------------|:-----------:|:--------------------------------------------------------------------------------------------------|
| /<user_id: string>       |     нет     | Вернуть информацию по конкретному пользователю, если user_id не задан вернет список пользователей |
| is_minimum_data: boolean |     нет     | Если true вернет краткую информацию об пользователе                                               |

- **POST**. Требует авторизации. Не требует права администратора. Authorization-Token должен принадлежать пользователю
  > Регистрирует пользователя в системе, если он не найден. Для этого необходимо передать в заголовке "Authorization"
  токен авторизации Firebase Auth. Данные принимаются в виде json

*Заголовок*

| Название      |     Тип      | Обязательно | Описание                       |
|---------------|:------------:|:-----------:|:-------------------------------|
| Authorization |    string    |     да      | Токен авторизации пользователя |

*Тело*:

| Название    |     Тип      | Обязательно | Описание                                          |
|-------------|:------------:|:-----------:|:--------------------------------------------------|
| Nickname    |    string    |     да      | Уникальное имя пользователя                       |
| Birthday    |   ISO-8601   |     да      | Дата рождения пользователя                        |
| Status      |    string    |     нет     | Текстовое сообщение в профиле пользователя        |
| Gender      |  UserGender  |     нет     | Пол пользователя                                  |
| Category    | UserCategory |     нет     | Категория пользователя                            |
| Image       |    base64    |     нет     | Изображение пользователя                          |
| DisplayName |    string    |     нет     | Имя пользователя которое будет везде отображаться |
| ExpoToken   |    string    |     нет     | Токен для отправки push-уведомлений через Expo    |

- **PUT**. Требует авторизации. Требует права администратора.
  > Обновляет данные пользователя на приведенные в теле. Данные принимаются в виде json

*Параметры*

| Название           | Обязательно | Описание                                                |
|--------------------|:-----------:|:--------------------------------------------------------|
| /<user_id: string> |     да      | id пользователя информацию которого необходимо обновить |

*Тело*:

| Параметр    |     Тип      | Описание                                          |
|-------------|:------------:|:--------------------------------------------------|
| Nickname    |    string    | Уникальное имя пользователя                       |
| Role        |   UserRole   | Роль пользователя                                 |
| Birthday    |   ISO-8601   | Дата рождения пользователя                        |
| Status      |    string    | Текстовое сообщение в профиле пользователя        |
| Gender      |  UserGender  | Пол пользователя                                  |
| Category    | UserCategory | Категория пользователя                            |
| Image       |    base64    | Изображение пользователя                          |
| DisplayName |    string    | Имя пользователя которое будет везде отображаться |
| ExpoToken   |    string    | Токен для отправки push уведомлений через Expo    |

- **PATCH** Требует авторизации. Не требует права администратора.
  > Обновляет данные пользователя в системе, если он найден. Для этого необходимо передать в заголовке "Authorization"
  токен авторизации Firebase Auth. Данные принимаются в виде form-data

*Заголовок*

| Название      |     Тип      | Обязательно | Описание                       |
|---------------|:------------:|:-----------:|:-------------------------------|
| Authorization |    string    |     да      | Токен авторизации пользователя |

*Тело*:

| Название    |     Тип      | Обязательно | Описание                                          |
|-------------|:------------:|:-----------:|:--------------------------------------------------|
| nickname    |    string    |     да      | Уникальное имя пользователя                       |
| birthday    |   ISO-8601   |     да      | Дата рождения пользователя                        |
| status      |    string    |     нет     | Текстовое сообщение в профиле пользователя        |
| gender      |  UserGender  |     нет     | Пол пользователя                                  |
| category    | UserCategory |     нет     | Категория пользователя                            |
| image       |    base64    |     нет     | Изображение пользователя                          |
| displayName |    string    |     нет     | Имя пользователя которое будет везде отображаться |

#### /authentication

- **GET**. Требует авторизации. Не требует права администратора.
  > Возвращает данные пользователя на основании токена

>
*Заголовок*

| Название      |     Тип      | Обязательно | Описание                       |
|---------------|:------------:|:-----------:|:-------------------------------|
| Authorization |    string    |     да      | Токен авторизации пользователя |

### /user.image

- **GET**. Не требует авторизации. Не требует права администратора.

> Возвращает изображение запрошенного пользователя

*Заголовок*

| Название | Обязательно | Описание                                                            |
|----------|:-----------:|:--------------------------------------------------------------------|
| token    |     да      | Firebase токен пользователя информацию которого необходимо обновить |

### /nickname

- **GET**. Не требует авторизации. Не требует права администратора.

> Возвращает информацию о пользователе с этим nickname

*Параметры*

| Название               | Обязательно | Описание                                                      |
|------------------------|:-----------:|:--------------------------------------------------------------|
| /<nickname: string>    |     да      | Nickname пользователя информацию которого необходимо получить |
| isMinimumData: boolean |     нет     | Если true вернет краткую информацию об пользователе           |

### /meditation

- **GET**. Не требует авторизации. Не требует права администратора.
  > Возвращает информацию обо всех, конкретных или по параметрам медитациях. Если запрос имеет одновременно
  preferences=true и
  popularToDay=true, то вернёт список медитаций по параметрам.

*Заголовок*

| Название        |  Тип   | Обязательно | Описание                                                                                   |
|-----------------|:------:|:-----------:|:-------------------------------------------------------------------------------------------|
| Authorization   | string |     нет     | Токен авторизации пользователя                                                             |
| Accept-Language | string |     да      | Дву символьное обозначения естественного языка на котором вернуть информацию об медитациях |

*Параметры*

| Параметр                                  | Обязательно | Описание                                                                                        |
|-------------------------------------------|:-----------:|:------------------------------------------------------------------------------------------------|
| /<meditation_id: string>                  |     нет     | Вернуть информацию по конкретной медитации, если meditation_id не задан вернет список медитаций |
| is_minimum_data: boolean                  |     нет     | Если true вернет краткую информацию об медитации                                                |
| preferences:  MeditationPreferences       |     нет     | Вернет информацию об медитацию которая подходит под параметры, или случайную                    |
| getIsNotListened: boolean                 |     нет     | Если true то вернет исключит из рекомендаций медитации которые были уже просушены. *            |
| Так же необходимо передать Authorization* |             |                                                                                                 |
| popularToDay: boolean                     |     нет     | Вернет информацию об медитацию которая в текущие сутки является самой прослушиваемой            |

- **POST**. Требует авторизации. Требует права администратора.
  > Добавляет информацию об медитации. Данные принимаются в виде form-data. Чтобы загрузить аудиозаписи на разных
  языках, необходимо каждый чтобы поле в котором будет находиться аудио запись имело шаблон названия audio_language, где
  language - дву символьное обозначения естественного языка

*Заголовок*

| Название      |     Тип      | Обязательно | Описание                       |
|---------------|:------------:|:-----------:|:-------------------------------|
| Authorization |    string    |     да      | Токен авторизации пользователя |

В данном случаем данные будут загружены и создаться новая медитация

*Тело*:

| Название       |      Тип       | Обязательно | Описание                                       |
|----------------|:--------------:|:-----------:|:-----------------------------------------------|
| name           |     string     |     да      | Название медитации                             |
| description    |     string     |     да      | Описание медитации                             |
| image          |     base64     |     да      | изображение медитации                          |
| TypeMeditation | TypeMeditation |     да      | Тип медитации                                  |
| audio          |     base64     |     да      | Аудио запись медитации                         |
| isSubscribe    |    boolean     |     нет     | Чтобы прослушать медитацию необходима подписка |

- **PATCH** Требует авторизации. Требует права администратора.
  > Обновляет данные об медитации в системе, если он найден. Данные принимаются в виде form-data

*Заголовок*

| Название      |     Тип      | Обязательно | Описание                       |
|---------------|:------------:|:-----------:|:-------------------------------|
| Authorization |    string    |     да      | Токен авторизации пользователя |

*Тело*:

| Название       |      Тип       | Обязательно | Описание                                       |
|----------------|:--------------:|:-----------:|:-----------------------------------------------|
| name           |     string     |     да      | Название медитации                             |
| description    |     string     |     да      | Описание медитации                             |
| image          |     base64     |     да      | изображение медитации                          |
| TypeMeditation | TypeMeditation |     да      | Тип медитации                                  |
| isSubscribe    |    boolean     |     нет     | Чтобы прослушать медитацию необходима подписка |

### /meditation.audio

- **GET**. Не требует авторизации. Не требует права администратора.
  > Возвращает аудио запись конкретной медитации на конкретном языке.

*Заголовок*

| Название        |  Тип   | Обязательно | Описание                                                                                   |
|-----------------|:------:|:-----------:|:-------------------------------------------------------------------------------------------|
| Authorization   | string |     да      | Токен авторизации пользователя                                                             |

*Параметры*

| Параметр                 | Обязательно | Описание                                                                                            |
|--------------------------|:-----------:|:----------------------------------------------------------------------------------------------------|
| /<meditation_id: string> |     нет     | Вернуть информацию по конкретной медитации, если meditation_id не задан вернет список пользователей |
| Accept-Language          |     да      | Дву символьное обозначения естественного языка на котором вернуть информацию об медитациях          |

### /meditation.image

- **Get**. Не требует авторизации. Не требует права администратора.
  > Возвращает фотографию конкретной медитации

>
*Параметры*

| Название | Тип    | Обязательно | Описание                                                |
|----------|--------|-------------|---------------------------------------------------------|
| token    | string | Да          | Токен авторизации пользователя                          |
| id       | int    | Да          | Id медитации для который необходимо получить фотографию |

### /dmd

- **Get** Не требует авторизации.

> Без параметров возвращает список всех dmd. С параметро id вернёт опредлённый dmd.

*Параметры*

| Название | Тип | Обязательно | Описание            |
|----------|-----|-------------|---------------------|
| id       | int | Нет         | id необходимого dmd |

- **Post**

> Добавляет dmd в базу.

*Параметры*

| Название | Тип    | Обязательно | Описание                                |
|----------|--------|-------------|-----------------------------------------|
| ids      | int[]  | Да          | Массив медитация их которых состоит dmd |
| name     | string | Да          | Название для dmd                        |

### /payment

- **Get**. Требует авторизации.

> Возвращает уникальный идентификатор для оплаты.

*Параметры*

| Название | Тип    | Обязательно | Описание                       |
|----------|--------|-------------|--------------------------------|
| token    | string | Да          | Токен авторизации пользователя |

- **Post** После оплаты необходимо подтвердить, что оплата прошла успешно

> Ничего не возвращает

*Параметры*

| Название | Тип    | Описание                           |
|----------|--------|------------------------------------|
| token    | string | Токен авторизации пользователя     |
| id       | int    | Id оплаты полученной из метода Get |

### /subscribe

- **Post** - Требует авторизации пользователя.

> Добавляет пользователю подписку на медитации

*Параметры*

| Название | Тип    | Обязательно | Описание                       |
|----------|--------|-------------|--------------------------------|
| token    | string | да          | Токен авторизации пользователя |
| subTime  | int    | да          | Время подписки пользователя    |

-**Delete**

*Параметры*
> Убирает у пользователя подписку на медитации

| Название | Тип      | Обязаельно | Описание                       |
|----------|----------|------------|--------------------------------|
| token    | string   | Да         | Токен авторизации пользователя |

### /test

- **Get**

> При обращении всегда возвращает 204 response

